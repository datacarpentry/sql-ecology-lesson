<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Data Management with SQL for Ecologists: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="../assets/images/data-logo.svg">
</div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Data Management with SQL for Ecologists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Data Management with SQL for Ecologists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Management with SQL for Ecologists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-sql-introduction.html">1. Introducing Databases and SQL</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-sql-basic-queries.html">2. Accessing Data With Queries</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-sql-aggregation.html">3. Aggregating and Grouping Data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-sql-joins.html">4. Combining Data With Joins</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-00-sql-introduction"><p>Content from <a href="00-sql-introduction.html">Introducing Databases and SQL</a></p>
<hr>
<p> Last updated on 2023-04-21 | 
        
        <a href="https://github.com/datacarpentry/sql-ecology-lesson/edit/main/episodes/00-sql-introduction.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 65 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a relational database and why should I use it?</li>
<li>What is SQL?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe why relational databases are useful.</li>
<li>Create and populate a database from a text file.</li>
<li>Define SQLite data types.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p><em>Note: this should have been done by participants before the start
of the workshop.</em></p>
<p>We use <a href="https://sqlitebrowser.org/" class="external-link">DB Browser for SQLite</a>
and the <a href="https://figshare.com/articles/Portal_Project_Teaching_Database/1314459" class="external-link">Portal
Project dataset</a> throughout this lesson. See <a href="index.html#setup">Setup</a> for instructions on how to download the
data, and also how to install DB Browser for SQLite.</p>
</div>
<section id="motivation"><h2 class="section-heading">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<hr class="half-width">
<p>To start, let’s orient ourselves in our project workflow. Previously,
we used Excel and OpenRefine to go from messy, human created data to
cleaned, computer-readable data. Now we’re going to move to the next
piece of the data workflow, using the computer to read in our data, and
then use it for analysis and visualization.</p>
<div class="section level3">
<h3 id="what-is-sql">What is SQL?<a class="anchor" aria-label="anchor" href="#what-is-sql"></a>
</h3>
<p>SQL stands for Structured Query Language. SQL allows us to interact
with relational databases through queries. These queries can allow you
to perform a number of actions such as: insert, select, update and
delete information in a database.</p>
</div>
<div class="section level3">
<h3 id="dataset-description">Dataset Description<a class="anchor" aria-label="anchor" href="#dataset-description"></a>
</h3>
<p>The data we will be using is a time-series for a small mammal
community in southern Arizona. This is part of a project studying the
effects of rodents and ants on the plant community that has been running
for almost 40 years. The rodents are sampled on a series of 24 plots,
with different experimental manipulations controlling which rodents are
allowed to access which plots.</p>
<p>This is a real dataset that has been used in over 100 publications.
We’ve simplified it for the workshop, but you can download the <a href="https://esapubs.org/archive/ecol/E090/118/" class="external-link">full dataset</a> and
work with it using exactly the same tools we’ll learn about today.</p>
</div>
<div class="section level3">
<h3 id="questions">Questions<a class="anchor" aria-label="anchor" href="#questions"></a>
</h3>
<p>Let’s look at some of the cleaned spreadsheets you downloaded during
<a href="index.html#setup">Setup</a> to complete this challenge. You’ll need
the following three files:</p>
<ul>
<li><code>surveys.csv</code></li>
<li><code>species.csv</code></li>
<li><code>plots.csv</code></li>
</ul>
<div id="challenge" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>Open each of these csv files and explore them. What information is
contained in each file? Specifically, if I had the following research
questions:</p>
<ul>
<li>How has the hindfoot length and weight of <em>Dipodomys</em> species
changed over time?</li>
<li>What is the average weight of each species, per year?</li>
<li>What information can I learn about <em>Dipodomys</em> species in the
2000s, over time?</li>
</ul>
<p>What would I need to answer these questions? Which files have the
data I need? What operations would I need to perform if I were doing
these analyses by hand?</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="goals">Goals<a class="anchor" aria-label="anchor" href="#goals"></a>
</h3>
<p>In order to answer the questions described above, we’ll need to do
the following basic data operations:</p>
<ul>
<li>select subsets of the data (rows and columns)</li>
<li>group subsets of data</li>
<li>do math and other calculations</li>
<li>combine data across spreadsheets</li>
</ul>
<p>In addition, we don’t want to do this manually! Instead of searching
for the right pieces of data ourselves, or clicking between
spreadsheets, or manually sorting columns, we want to make the computer
do the work.</p>
<p>In particular, we want to use a tool where it’s easy to repeat our
analysis in case our data changes. We also want to do all this searching
without actually modifying our source data.</p>
<p>Putting our data into a relational database and using SQL will help
us achieve these goals.</p>
<div id="definition-relational-database" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="definition-relational-database" class="callout-inner">
<h3 class="callout-title">Definition: <em>Relational Database</em><a class="anchor" aria-label="anchor" href="#definition-relational-database"></a>
</h3>
<div class="callout-content">
<p>A relational database stores data in <em>relations</em> made up of
<em>records</em> with <em>fields</em>. The relations are usually
represented as <em>tables</em>; each record is usually shown as a row,
and the fields as columns. In most cases, each record will have a unique
identifier, called a <em>key</em>, which is stored as one of its fields.
Records may also contain keys that refer to records in other tables,
which enables us to combine information from two or more sources.</p>
</div>
</div>
</div>
</div>
</section><section id="databases"><h2 class="section-heading">Databases<a class="anchor" aria-label="anchor" href="#databases"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="why-use-relational-databases">Why use relational databases<a class="anchor" aria-label="anchor" href="#why-use-relational-databases"></a>
</h3>
<p>Using a relational database serves several purposes.</p>
<ul>
<li>It keeps your data separate from your analysis.
<ul>
<li>This means there’s no risk of accidentally changing data when you
analyze it.</li>
<li>If we get new data we can rerun the query.</li>
</ul>
</li>
<li>It’s fast, even for large amounts of data.</li>
<li>It improves quality control of data entry (type constraints and use
of forms in MS Access, Filemaker, Oracle Application Express etc.)</li>
<li>The concepts of relational database querying are core to
understanding how to do similar things using programming languages such
as R or Python.</li>
</ul>
</div>
<div class="section level3">
<h3 id="database-management-systems">Database Management Systems<a class="anchor" aria-label="anchor" href="#database-management-systems"></a>
</h3>
<p>There are different database management systems to work with
relational databases such as SQLite, MySQL, PostgreSQL, MSSQL Server,
and many more. Each of them differ mainly based on their scalability,
but they all share the same core principles of relational databases. In
this lesson, we use SQLite to introduce you to SQL and data retrieval
from a relational database.</p>
</div>
<div class="section level3">
<h3 id="relational-databases">Relational databases<a class="anchor" aria-label="anchor" href="#relational-databases"></a>
</h3>
<p>Let’s look at a pre-existing database, the
<code>portal_mammals.sqlite</code> file from the Portal Project dataset
that we downloaded during <a href="index.html#setup">Setup</a>. Click on the
“Open Database” button, select the portal_mammals.sqlite file, and click
“Open” to open the database.</p>
<p>You can see the tables in the database by looking at the left hand
side of the screen under Database Structure tab. Here you will see a
list under “Tables.” Each item listed here corresponds to one of the
<code>csv</code> files we were exploring earlier. To see the contents of
any table, right-click on it, and then click the “Browse Table” from the
menu, or select the “Browse Data” tab next to the “Database Structure”
tab and select the wanted table from the dropdown named “Table”. This
will give us a view that we’re used to - a copy of the table. Hopefully
this helps to show that a database is, in some sense, just a collection
of tables, where there’s some value in the tables that allows them to be
connected to each other (the “related” part of “relational
database”).</p>
<p>The “Database Structure” tab also provides some metadata about each
table. If you click on the down arrow next to a table name, you will see
information about the columns, which in databases are referred to as
“fields,” and their assigned data types. (The rows of a database table
are called <em>records</em>.) Each field contains one variety or type of
data, often numbers or text. You can see in the <code>surveys</code>
table that most fields contain numbers (BIGINT, or big integer, and
FLOAT, or floating point numbers/decimals) while the
<code>species</code> table is entirely made up of text fields.</p>
<p>The “Execute SQL” tab is blank now - this is where we’ll be typing
our queries to retrieve information from the database tables.</p>
<p>To summarize:</p>
<ul>
<li>Relational databases store data in tables with fields (columns) and
records (rows)</li>
<li>Data in tables has types, and all values in a field have the same
type (<a href="#datatypes">list of data types</a>)</li>
<li>Queries let us look up data or make calculations based on
columns</li>
</ul>
</div>
<div class="section level3">
<h3 id="database-design">Database Design<a class="anchor" aria-label="anchor" href="#database-design"></a>
</h3>
<ul>
<li>Every row-column combination contains a single <em>atomic</em>
value, i.e., not containing parts we might want to work with
separately.</li>
<li>One field per type of information</li>
<li>No redundant information
<ul>
<li>Split into separate tables with one table per class of
information</li>
<li>Needs an identifier in common between tables – shared column - to
reconnect (known as a <em>foreign key</em>).</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="import">Import<a class="anchor" aria-label="anchor" href="#import"></a>
</h3>
<p>Before we get started with writing our own queries, we’ll create our
own database. We’ll be creating this database from the three
<code>csv</code> files we downloaded earlier. Close the currently open
database (<strong>File &gt; Close Database</strong>) and then follow
these instructions:</p>
<ol style="list-style-type: decimal">
<li>Start a New Database</li>
</ol>
<ul>
<li>Click the <strong>New Database</strong> button</li>
<li>Give a name and click Save to create the database in the opened
folder</li>
<li>In the “Edit table definition” window that pops up, click cancel as
we will be importing tables, not creating them from scratch</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Select <strong>File &gt;&gt; Import &gt;&gt; Table from CSV
file…</strong>
</li>
<li>Choose <code>surveys.csv</code> from the data folder we downloaded
and click <strong>Open</strong>.</li>
<li>Give the table a name that matches the file name
(<code>surveys</code>), or use the default</li>
<li>If the first row has column headings, be sure to check the box next
to “Column names in first line”.</li>
<li>Be sure the field separator and quotation options are correct. If
you’re not sure which options are correct, test some of the options
until the preview at the bottom of the window looks right.</li>
<li>Press <strong>OK</strong>, you should subsequently get a message
that the table was imported.</li>
<li>Back on the Database Structure tab, you should now see the table
listed. Right click on the table name and choose <strong>Modify
Table</strong>, or click on the <strong>Modify Table</strong> button
just under the tabs and above the table list.</li>
<li>Click <strong>Save</strong> if asked to save all pending
changes.</li>
<li>In the center panel of the window that appears, set the data types
for each field using the suggestions in the table below (this includes
fields from the <code>plots</code> and <code>species</code> tables
also).</li>
<li>Finally, click <strong>OK</strong> one more time to confirm the
operation. Then click the <strong>Write Changes</strong> button to save
the database.</li>
</ol>
<table style="width:100%;" class="table">
<colgroup>
<col width="21%">
<col width="42%">
<col width="29%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th>Field</th>
<th align="left">Data Type</th>
<th>Motivation</th>
<th>Table(s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>day</td>
<td align="left">INTEGER</td>
<td>Having data as numeric allows for meaningful arithmetic and
comparisons</td>
<td>surveys</td>
</tr>
<tr class="even">
<td>genus</td>
<td align="left">TEXT</td>
<td>Field contains text data</td>
<td>species</td>
</tr>
<tr class="odd">
<td>hindfoot_length</td>
<td align="left">REAL</td>
<td>Field contains measured numeric data</td>
<td>surveys</td>
</tr>
<tr class="even">
<td>month</td>
<td align="left">INTEGER</td>
<td>Having data as numeric allows for meaningful arithmetic and
comparisons</td>
<td>surveys</td>
</tr>
<tr class="odd">
<td>plot_id</td>
<td align="left">INTEGER</td>
<td>Field contains numeric data</td>
<td>plots, surveys</td>
</tr>
<tr class="even">
<td>plot_type</td>
<td align="left">TEXT</td>
<td>Field contains text data</td>
<td>plots</td>
</tr>
<tr class="odd">
<td>record_id</td>
<td align="left">INTEGER</td>
<td>Field contains numeric data</td>
<td>surveys</td>
</tr>
<tr class="even">
<td>sex</td>
<td align="left">TEXT</td>
<td>Field contains text data</td>
<td>surveys</td>
</tr>
<tr class="odd">
<td>species_id</td>
<td align="left">TEXT</td>
<td>Field contains text data</td>
<td>species, surveys</td>
</tr>
<tr class="even">
<td>species</td>
<td align="left">TEXT</td>
<td>Field contains text data</td>
<td>species</td>
</tr>
<tr class="odd">
<td>taxa</td>
<td align="left">TEXT</td>
<td>Field contains text data</td>
<td>species</td>
</tr>
<tr class="even">
<td>weight</td>
<td align="left">REAL</td>
<td>Field contains measured numerical data</td>
<td>surveys</td>
</tr>
<tr class="odd">
<td>year</td>
<td align="left">INTEGER</td>
<td>Allows for meaningful arithmetic and comparisons</td>
<td>surveys</td>
</tr>
</tbody>
</table>
<div id="challenge-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Import the <code>plots</code> and <code>species</code> tables</li>
</ul>
</div>
</div>
</div>
<p>You can also use this same approach to append new fields to an
existing table.</p>
</div>
<div class="section level3">
<h3 id="adding-fields-to-existing-tables">Adding fields to existing tables<a class="anchor" aria-label="anchor" href="#adding-fields-to-existing-tables"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Go to the “Database Structure” tab, right click on the table you’d
like to add data to, and choose <strong>Modify Table</strong>, or click
on the <strong>Modify Table</strong> just under the tabs and above the
table.</li>
<li>Click the <strong>Add Field</strong> button to add a new field and
assign it a data type.</li>
</ol>
</div>
<div class="section level3">
<h3 id="datatypes">Data types<a class="anchor" aria-label="anchor" href="#datatypes"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="66%">
</colgroup>
<thead><tr class="header">
<th>Data type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>CHARACTER(n)</td>
<td align="left">Character string. Fixed-length n</td>
</tr>
<tr class="even">
<td>VARCHAR(n) or CHARACTER VARYING(n)</td>
<td align="left">Character string. Variable length. Maximum length
n</td>
</tr>
<tr class="odd">
<td>BINARY(n)</td>
<td align="left">Binary string. Fixed-length n</td>
</tr>
<tr class="even">
<td>BOOLEAN</td>
<td align="left">Stores TRUE or FALSE values</td>
</tr>
<tr class="odd">
<td>VARBINARY(n) or BINARY VARYING(n)</td>
<td align="left">Binary string. Variable length. Maximum length n</td>
</tr>
<tr class="even">
<td>INTEGER(p)</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="odd">
<td>SMALLINT</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="even">
<td>INTEGER</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="odd">
<td>BIGINT</td>
<td align="left">Integer numerical (no decimal).</td>
</tr>
<tr class="even">
<td>DECIMAL(p,s)</td>
<td align="left">Exact numerical, precision p, scale s.</td>
</tr>
<tr class="odd">
<td>NUMERIC(p,s)</td>
<td align="left">Exact numerical, precision p, scale s. (Same as
DECIMAL)</td>
</tr>
<tr class="even">
<td>FLOAT(p)</td>
<td align="left">Approximate numerical, mantissa precision p. A floating
number in base 10 exponential notation.</td>
</tr>
<tr class="odd">
<td>REAL</td>
<td align="left">Approximate numerical</td>
</tr>
<tr class="even">
<td>FLOAT</td>
<td align="left">Approximate numerical</td>
</tr>
<tr class="odd">
<td>DOUBLE PRECISION</td>
<td align="left">Approximate numerical</td>
</tr>
<tr class="even">
<td>DATE</td>
<td align="left">Stores year, month, and day values</td>
</tr>
<tr class="odd">
<td>TIME</td>
<td align="left">Stores hour, minute, and second values</td>
</tr>
<tr class="even">
<td>TIMESTAMP</td>
<td align="left">Stores year, month, day, hour, minute, and second
values</td>
</tr>
<tr class="odd">
<td>INTERVAL</td>
<td align="left">Composed of a number of integer fields, representing a
period of time, depending on the type of interval</td>
</tr>
<tr class="even">
<td>ARRAY</td>
<td align="left">A set-length and ordered collection of elements</td>
</tr>
<tr class="odd">
<td>MULTISET</td>
<td align="left">A variable-length and unordered collection of
elements</td>
</tr>
<tr class="even">
<td>XML</td>
<td align="left">Stores XML data</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="datatypediffs">SQL Data Type Quick Reference<a class="anchor" aria-label="anchor" href="#datatypediffs"></a>
</h3>
<p>Different databases offer different choices for the data type
definition.</p>
<p>The following table shows some of the common names of data types
between the various database platforms:</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="38%">
<col width="26%">
<col width="5%">
<col width="4%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left">Data type</th>
<th align="left">Access</th>
<th align="left">SQLServer</th>
<th align="left">Oracle</th>
<th align="left">MySQL</th>
<th align="left">PostgreSQL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">boolean</td>
<td align="left">Yes/No</td>
<td align="left">Bit</td>
<td align="left">Byte</td>
<td align="left">N/A</td>
<td align="left">Boolean</td>
</tr>
<tr class="even">
<td align="left">integer</td>
<td align="left">Number (integer)</td>
<td align="left">Int</td>
<td align="left">Number</td>
<td align="left">Int / Integer</td>
<td align="left">Int / Integer</td>
</tr>
<tr class="odd">
<td align="left">float</td>
<td align="left">Number (single)</td>
<td align="left">Float / Real</td>
<td align="left">Number</td>
<td align="left">Float</td>
<td align="left">Numeric</td>
</tr>
<tr class="even">
<td align="left">currency</td>
<td align="left">Currency</td>
<td align="left">Money</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">Money</td>
</tr>
<tr class="odd">
<td align="left">string (fixed)</td>
<td align="left">N/A</td>
<td align="left">Char</td>
<td align="left">Char</td>
<td align="left">Char</td>
<td align="left">Char</td>
</tr>
<tr class="even">
<td align="left">string (variable)</td>
<td align="left">Text (&lt;256) / Memo (65k+)</td>
<td align="left">Varchar</td>
<td align="left">Varchar2</td>
<td align="left">Varchar</td>
<td align="left">Varchar</td>
</tr>
<tr class="odd">
<td align="left">binary object OLE Object Memo Binary (fixed up to
8K)</td>
<td align="left">Varbinary (&lt;8K)</td>
<td align="left">Image (&lt;2GB) Long</td>
<td align="left">Raw Blob</td>
<td align="left">Text Binary</td>
<td align="left">Varbinary</td>
</tr>
</tbody>
</table>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>SQL allows us to select and group subsets of data, do math and other
calculations, and combine data.</li>
<li>A relational database is made up of tables which are related to each
other by shared keys.</li>
<li>Different database management systems (DBMS) use slightly different
vocabulary, but they are all based on the same ideas.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-01-sql-basic-queries"><p>Content from <a href="01-sql-basic-queries.html">Accessing Data With Queries</a></p>
<hr>
<p> Last updated on 2023-04-21 | 
        
        <a href="https://github.com/datacarpentry/sql-ecology-lesson/edit/main/episodes/01-sql-basic-queries.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 35 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I write a basic query in SQL?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write and build queries.</li>
<li>Filter data given various criteria.</li>
<li>Sort the results of a query.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="writing-my-first-query"><h2 class="section-heading">Writing my first query<a class="anchor" aria-label="anchor" href="#writing-my-first-query"></a>
</h2>
<hr class="half-width">
<p>Let’s start by using the <strong>surveys</strong> table. Here we have
data on every individual that was captured at the site, including when
they were captured, what plot they were captured on, their species ID,
sex and weight in grams.</p>
<p>Let’s write an SQL query that selects all of the columns in the
surveys table. SQL queries can be written in the box located under the
“Execute SQL” tab. Click on the right arrow above the query box to
execute the query. (You can also use the keyboard shortcut “Cmd-Enter”
on a Mac or “Ctrl-Enter” on a Windows machine to execute a query.) The
results are displayed in the box below your query. If you want to
display all of the columns in a table, use the wildcard *.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>We have capitalized the words SELECT and FROM because they are SQL
keywords. SQL is case insensitive, but it helps for readability, and is
good style.</p>
<p>If we want to select a single column, we can type the column name
instead of the wildcard *.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>If we want more information, we can add more columns to the list of
fields, right after SELECT:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span>, <span class="dt">month</span>, <span class="dt">day</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<div class="section level3">
<h3 id="limiting-results">Limiting results<a class="anchor" aria-label="anchor" href="#limiting-results"></a>
</h3>
<p>Sometimes you don’t want to see all the results, you just want to get
a sense of what’s being returned. In that case, you can use a
<code>LIMIT</code> clause. In particular, you would want to do this if
you were working with large databases.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="unique-values">Unique values<a class="anchor" aria-label="anchor" href="#unique-values"></a>
</h3>
<p>If we want only the unique values so that we can quickly see what
species have been sampled we use <code>DISTINCT</code></p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> species_id</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>If we select more than one column, then the distinct pairs of values
are returned</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="dt">year</span>, species_id</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="calculated-values">Calculated values<a class="anchor" aria-label="anchor" href="#calculated-values"></a>
</h3>
<p>We can also do calculations with the values in a query. For example,
if we wanted to look at the mass of each individual on different dates,
but we needed it in kg instead of g we would use</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span>, <span class="dt">month</span>, <span class="dt">day</span>, weight<span class="op">/</span><span class="dv">1000</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>When we run the query, the expression <code>weight / 1000</code> is
evaluated for each row and appended to that row, in a new column. If we
used the <code>INTEGER</code> data type for the weight field then
integer division would have been done, to obtain the correct results in
that case divide by <code>1000.0</code>. Expressions can use any fields,
any arithmetic operators (<code>+</code>, <code>-</code>,
<code>*</code>, and <code>/</code>) and a variety of built-in functions.
For example, we could round the values to make them easier to read.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> plot_id, species_id, sex, weight, <span class="fu">ROUND</span>(weight <span class="op">/</span> <span class="dv">1000</span>, <span class="dv">2</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that returns the year, month, day, species_id and
weight in mg.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">day</span>, <span class="dt">month</span>, <span class="dt">year</span>, species_id, weight <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="filtering"><h2 class="section-heading">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h2>
<hr class="half-width">
<p>Databases can also filter data – selecting only the data meeting
certain criteria. For example, let’s say we only want data for the
species <em>Dipodomys merriami</em>, which has a species code of DM. We
need to add a <code>WHERE</code> clause to our query:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species_id<span class="op">=</span><span class="st">'DM'</span>;</span></code></pre>
</div>
<p>We can do the same thing with numbers. Here, we only want the data
since 2000:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> surveys</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="dt">year</span> <span class="op">&gt;=</span> <span class="dv">2000</span>;</span></code></pre>
</div>
<p>If we used the <code>TEXT</code> data type for the year, the
<code>WHERE</code> clause should be <code>year &gt;= '2000'</code>.</p>
<p>We can use more sophisticated conditions by combining tests with
<code>AND</code> and <code>OR</code>. For example, suppose we want the
data on <em>Dipodomys merriami</em> starting in the year 2000:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (<span class="dt">year</span> <span class="op">&gt;=</span> <span class="dv">2000</span>) <span class="kw">AND</span> (species_id <span class="op">=</span> <span class="st">'DM'</span>);</span></code></pre>
</div>
<p>Note that the parentheses are not needed, but again, they help with
readability. They also ensure that the computer combines
<code>AND</code> and <code>OR</code> in the way that we intend.</p>
<p>If we wanted to get data for any of the <em>Dipodomys</em> species,
which have species codes <code>DM</code>, <code>DO</code>, and
<code>DS</code>, we could combine the tests using OR:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (species_id <span class="op">=</span> <span class="st">'DM'</span>) <span class="kw">OR</span> (species_id <span class="op">=</span> <span class="st">'DO'</span>) <span class="kw">OR</span> (species_id <span class="op">=</span> <span class="st">'DS'</span>);</span></code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Produce a table listing the data for all individuals in Plot 1 that
weighed more than 75 grams, telling us the date, species id code, and
weight (in kg).</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">day</span>, <span class="dt">month</span>, <span class="dt">year</span>, species_id, weight <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (plot_id <span class="op">=</span> <span class="dv">1</span>) <span class="kw">AND</span> (weight <span class="op">&gt;</span> <span class="dv">75</span>);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="building-more-complex-queries"><h2 class="section-heading">Building more complex queries<a class="anchor" aria-label="anchor" href="#building-more-complex-queries"></a>
</h2>
<hr class="half-width">
<p>Now, let’s combine the above queries to get data for the 3
<em>Dipodomys</em> species from the year 2000 on. This time, let’s use
IN as one way to make the query easier to understand. It is equivalent
to saying
<code>WHERE (species_id = 'DM') OR (species_id = 'DO') OR (species_id = 'DS')</code>,
but reads more neatly:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (<span class="dt">year</span> <span class="op">&gt;=</span> <span class="dv">2000</span>) <span class="kw">AND</span> (species_id <span class="kw">IN</span> (<span class="st">'DM'</span>, <span class="st">'DO'</span>, <span class="st">'DS'</span>));</span></code></pre>
</div>
<p>We started with something simple, then added more clauses one by one,
testing their effects as we went along. For complex queries, this is a
good strategy, to make sure you are getting what you want. Sometimes it
might help to take a subset of the data that you can easily see in a
temporary database to practice your queries on before working on a
larger or more complicated database.</p>
<p>When the queries become more complex, it can be useful to add
comments. In SQL, comments are started by <code>--</code>, and end at
the end of the line. For example, a commented version of the above query
can be written as:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get post 2000 data on Dipodomys' species</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- These are in the surveys table, and we are interested in all columns</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> surveys</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sampling year is in the column `year`, and we want to include 2000</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (<span class="dt">year</span> <span class="op">&gt;=</span> <span class="dv">2000</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Dipodomys' species have the `species_id` DM, DO, and DS</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">AND</span> (species_id <span class="kw">IN</span> (<span class="st">'DM'</span>, <span class="st">'DO'</span>, <span class="st">'DS'</span>));</span></code></pre>
</div>
<p>Although SQL queries often read like plain English, it is
<em>always</em> useful to add comments; this is especially true of more
complex queries.</p>
</section><section id="sorting"><h2 class="section-heading">Sorting<a class="anchor" aria-label="anchor" href="#sorting"></a>
</h2>
<hr class="half-width">
<p>We can also sort the results of our queries by using
<code>ORDER BY</code>. For simplicity, let’s go back to the
<strong>species</strong> table and alphabetize it by taxa.</p>
<p>First, let’s look at what’s in the <strong>species</strong> table.
It’s a table of the species_id and the full genus, species and taxa
information for each species_id. Having this in a separate table is
nice, because we didn’t need to include all this information in our main
<strong>surveys</strong> table.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species;</span></code></pre>
</div>
<p>Now let’s order it by taxa.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> taxa <span class="kw">ASC</span>;</span></code></pre>
</div>
<p>The keyword <code>ASC</code> tells us to order it in ascending order.
We could alternately use <code>DESC</code> to get descending order.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> taxa <span class="kw">DESC</span>;</span></code></pre>
</div>
<p><code>ASC</code> is the default.</p>
<p>We can also sort on several fields at once. To truly be alphabetical,
we might want to order by genus then species.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> genus <span class="kw">ASC</span>, species <span class="kw">ASC</span>;</span></code></pre>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that returns year, species_id, and weight in kg from
the surveys table, sorted with the largest weights at the top.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span>, species_id, weight <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> weight <span class="kw">DESC</span>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="order-of-execution"><h2 class="section-heading">Order of execution<a class="anchor" aria-label="anchor" href="#order-of-execution"></a>
</h2>
<hr class="half-width">
<p>Another note for ordering. We don’t actually have to display a column
to sort by it. For example, let’s say we want to order the birds by
their species ID, but we only want to see genus and species.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus, species</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> taxa <span class="op">=</span> <span class="st">'Bird'</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> species_id <span class="kw">ASC</span>;</span></code></pre>
</div>
<p>We can do this because sorting occurs earlier in the computational
pipeline than field selection.</p>
<p>The computer is basically doing this:</p>
<ol style="list-style-type: decimal">
<li>Filtering rows according to WHERE</li>
<li>Sorting results according to ORDER BY</li>
<li>Displaying requested columns or expressions.</li>
</ol>
<p>Clauses are written in a fixed order: <code>SELECT</code>,
<code>FROM</code>, <code>WHERE</code>, then <code>ORDER BY</code>.</p>
<div id="multiple-statements" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="multiple-statements" class="callout-inner">
<h3 class="callout-title">Multiple statements<a class="anchor" aria-label="anchor" href="#multiple-statements"></a>
</h3>
<div class="callout-content">
<p>It is possible to write a query as a single line, but for
readability, we recommend to put each clause on its own line. The
standard way to separate a whole SQL statement is with a semicolon. This
allows more than one SQL statement to be executed together.</p>
</div>
</div>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<ul>
<li>Let’s try to combine what we’ve learned so far in a single query.
Using the surveys table, write a query to display the three date fields,
<code>species_id</code>, and weight in kilograms (rounded to two decimal
places), for individuals captured in 1999, ordered alphabetically by the
<code>species_id</code>.</li>
<li>Write the query as a single line, then put each clause on its own
line, and see how more legible the query becomes!</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span>, <span class="dt">month</span>, <span class="dt">day</span>, species_id, <span class="fu">ROUND</span>(weight <span class="op">/</span> <span class="dv">1000</span>, <span class="dv">2</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">1999</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> species_id;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>It is useful to apply conventions when writing SQL queries to aid
readability.</li>
<li>Use logical connectors such as AND or OR to create more complex
queries.</li>
<li>Calculations using mathematical symbols can also be performed on SQL
queries.</li>
<li>Adding comments in SQL helps keep complex queries
understandable.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-sql-aggregation"><p>Content from <a href="02-sql-aggregation.html">Aggregating and Grouping Data</a></p>
<hr>
<p> Last updated on 2023-04-21 | 
        
        <a href="https://github.com/datacarpentry/sql-ecology-lesson/edit/main/episodes/02-sql-aggregation.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 60 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I summarize my data by aggregating, filtering, or ordering
query results?</li>
<li>How can I make sure column names from my queries make sense and
aren’t too long?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Apply aggregation functions to group records together.</li>
<li>Filter and order results of a query based on aggregate
functions.</li>
<li>Employ aliases to assign new names to items in a query.</li>
<li>Save a query to make a new table.</li>
<li>Apply filters to find missing values in SQL.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="count-and-group-by"><h2 class="section-heading">COUNT and GROUP BY<a class="anchor" aria-label="anchor" href="#count-and-group-by"></a>
</h2>
<hr class="half-width">
<p>Aggregation allows us to combine results by grouping records based on
value. It is also useful for calculating combined values in groups.</p>
<p>Let’s go to the surveys table and find out how many individuals there
are. Using the wildcard * counts the number of records (rows):</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>We can also find out how much all of those individuals weigh:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>), <span class="fu">SUM</span>(weight)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>We can output this value in kilograms (dividing the value by
1000.00), then rounding to 3 decimal places: (Notice the divisor has
numbers after the decimal point, which forces the answer to have a
decimal fraction)</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">ROUND</span>(<span class="fu">SUM</span>(weight)<span class="op">/</span><span class="fl">1000.00</span>, <span class="dv">3</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>There are many other aggregate functions included in SQL, for
example: <code>MAX</code>, <code>MIN</code>, and <code>AVG</code>.</p>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>Write a query that returns: the total weight, average weight, minimum
and maximum weights for all animals caught over the duration of the
survey. Can you modify it so that it outputs these values only for
weights between 5 and 10?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- All animals</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(weight), <span class="fu">AVG</span>(weight), <span class="fu">MIN</span>(weight), <span class="fu">MAX</span>(weight)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Only weights between 5 and 10</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(weight), <span class="fu">AVG</span>(weight), <span class="fu">MIN</span>(weight), <span class="fu">MAX</span>(weight)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (weight <span class="op">&gt;</span> <span class="dv">5</span>) <span class="kw">AND</span> (weight <span class="op">&lt;</span> <span class="dv">10</span>);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now, let’s see how many individuals were counted in each species. We
do this using a <code>GROUP BY</code> clause</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species_id;</span></code></pre>
</div>
<p><code>GROUP BY</code> tells SQL what field or fields we want to use
to aggregate the data. If we want to group by multiple fields, we give
<code>GROUP BY</code> a comma separated list.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Write queries that return:</p>
<ol style="list-style-type: decimal">
<li>How many individuals were counted in each year in total</li>
<li>How many were counted each year, for each different species</li>
<li>The average weights of each species in each year</li>
</ol>
<p>Can you get the answer to both 2 and 3 in a single query?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Solution of 1
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span>, <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dt">year</span>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Solution of 2 and 3
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span>, species_id, <span class="fu">COUNT</span>(<span class="op">*</span>), <span class="fu">AVG</span>(weight)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dt">year</span>, species_id;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="ordering-aggregated-results"><h2 class="section-heading">Ordering Aggregated Results<a class="anchor" aria-label="anchor" href="#ordering-aggregated-results"></a>
</h2>
<hr class="half-width">
<p>We can order the results of our aggregation by a specific column,
including the aggregated column. Let’s count the number of individuals
of each species captured, ordered by the count:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species_id</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">COUNT</span>(species_id);</span></code></pre>
</div>
</section><section id="aliases"><h2 class="section-heading">Aliases<a class="anchor" aria-label="anchor" href="#aliases"></a>
</h2>
<hr class="half-width">
<p>As queries get more complex, the expressions we use can get long and
unwieldy. To help make things clearer in the query and in its output, we
can use aliases to assign new names to things in the query.</p>
<p>We can use aliases in column names using <code>AS</code>:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(<span class="dt">year</span>) <span class="kw">AS</span> last_surveyed_year</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>The <code>AS</code> isn’t technically required, so you could do</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(<span class="dt">year</span>) last_surveyed_year</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>but using <code>AS</code> is much clearer so it is good style to
include it.</p>
<p>We can not only alias column names, but also table names in the same
way:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> surv;</span></code></pre>
</div>
<p>And again, the <code>AS</code> keyword is not required, so this
works, too:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys surv;</span></code></pre>
</div>
<p>Aliasing table names can be helpful when working with queries that
involve multiple tables; you will learn more about this later.</p>
</section><section id="the-having-keyword"><h2 class="section-heading">The <code>HAVING</code> keyword<a class="anchor" aria-label="anchor" href="#the-having-keyword"></a>
</h2>
<hr class="half-width">
<p>In the previous episode, we have seen the keyword <code>WHERE</code>,
allowing to filter the results according to some criteria. SQL offers a
mechanism to filter the results based on <strong>aggregate
functions</strong>, through the <code>HAVING</code> keyword.</p>
<p>For example, we can request to only return information about species
with a count higher than 10:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, <span class="fu">COUNT</span>(species_id)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species_id</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> <span class="fu">COUNT</span>(species_id) <span class="op">&gt;</span> <span class="dv">10</span>;</span></code></pre>
</div>
<p>The <code>HAVING</code> keyword works exactly like the
<code>WHERE</code> keyword, but uses aggregate functions instead of
database fields to filter.</p>
<p>You can use the <code>AS</code> keyword to assign an alias to a
column or table, and refer to that alias in the <code>HAVING</code>
clause. For example, in the above query, we can call the
<code>COUNT(species_id)</code> by another name, like
<code>occurrences</code>. This can be written this way:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, <span class="fu">COUNT</span>(species_id) <span class="kw">AS</span> occurrences</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species_id</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> occurrences <span class="op">&gt;</span> <span class="dv">10</span>;</span></code></pre>
</div>
<p>Note that in both queries, <code>HAVING</code> comes <em>after</em>
<code>GROUP BY</code>. One way to think about this is: the data are
retrieved (<code>SELECT</code>), which can be filtered
(<code>WHERE</code>), then joined in groups (<code>GROUP BY</code>);
finally, we can filter again based on some of these groups
(<code>HAVING</code>).</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Write a query that returns, from the <code>species</code> table, the
number of <code>species</code> in each <code>taxa</code>, only for the
<code>taxa</code> with more than 10 <code>species</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> taxa, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> n</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> taxa</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> n <span class="op">&gt;</span> <span class="dv">10</span>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="saving-queries-for-future-use"><h2 class="section-heading">Saving Queries for Future Use<a class="anchor" aria-label="anchor" href="#saving-queries-for-future-use"></a>
</h2>
<hr class="half-width">
<p>It is not uncommon to repeat the same operation more than once, for
example for monitoring or reporting purposes. SQL comes with a very
powerful mechanism to do this by creating views. Views are a form of
query that is saved in the database, and can be used to look at, filter,
and even update information. One way to think of views is as a table,
that can read, aggregate, and filter information from several places
before showing it to you.</p>
<p>Creating a view from a query requires us to add
<code>CREATE VIEW viewname AS</code> before the query itself. For
example, imagine that our project only covers the data gathered during
the summer (May - September) of 2000. That query would look like:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2000</span> <span class="kw">AND</span> (<span class="dt">month</span> <span class="op">&gt;</span> <span class="dv">4</span> <span class="kw">AND</span> <span class="dt">month</span> <span class="op">&lt;</span> <span class="dv">10</span>);</span></code></pre>
</div>
<p>But we don’t want to have to type that every time we want to ask a
question about that particular subset of data. Hence, we can benefit
from a view:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">VIEW</span> summer_2000 <span class="kw">AS</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2000</span> <span class="kw">AND</span> (<span class="dt">month</span> <span class="op">&gt;</span> <span class="dv">4</span> <span class="kw">AND</span> <span class="dt">month</span> <span class="op">&lt;</span> <span class="dv">10</span>);</span></code></pre>
</div>
<p>Using a view we will be able to access these results with a much
shorter notation:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species_id <span class="op">=</span> <span class="st">'PE'</span>;</span></code></pre>
</div>
</section><section id="what-about-null"><h2 class="section-heading">What About NULL?<a class="anchor" aria-label="anchor" href="#what-about-null"></a>
</h2>
<hr class="half-width">
<p>From the last example, there should only be five records. If you look
at the <code>weight</code> column, it’s easy to see what the average
weight would be. If we use SQL to find the average weight, SQL behaves
like we would hope, ignoring the NULL values:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(weight)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species_id <span class="op">=</span> <span class="st">'PE'</span>;</span></code></pre>
</div>
<p>But if we try to be extra clever, and find the average ourselves, we
might get tripped up:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(weight), <span class="fu">COUNT</span>(<span class="op">*</span>), <span class="fu">SUM</span>(weight)<span class="op">/</span><span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species_id <span class="op">=</span> <span class="st">'PE'</span>;</span></code></pre>
</div>
<p>Here the <code>COUNT</code> function includes all five records (even
those with NULL values), but the <code>SUM</code> only includes the
three records with data in the <code>weight</code> field, giving us an
incorrect average. However, our strategy <em>will</em> work if we modify
the <code>COUNT</code> function slightly:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">SUM</span>(weight), <span class="fu">COUNT</span>(weight), <span class="fu">SUM</span>(weight)<span class="op">/</span><span class="fu">COUNT</span>(weight)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species_id <span class="op">=</span> <span class="st">'PE'</span>;</span></code></pre>
</div>
<p>When we count the weight field specifically, SQL ignores the records
with data missing in that field. So here is one example where NULLs can
be tricky: <code>COUNT(*)</code> and <code>COUNT(field)</code> can
return different values.</p>
<p>Another case is when we use a “negative” query. Let’s count all the
non-female animals:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> sex <span class="op">!=</span> <span class="st">'F'</span>;</span></code></pre>
</div>
<p>Now let’s count all the non-male animals:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> sex <span class="op">!=</span> <span class="st">'M'</span>;</span></code></pre>
</div>
<p>But if we compare those two numbers with the total:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000;</span></code></pre>
</div>
<p>We’ll see that they don’t add up to the total! That’s because SQL
doesn’t automatically include NULL values in a negative conditional
statement. So if we are querying “not x”, then SQL divides our data into
three categories: ‘x’, ‘not NULL, not x’ and NULL; then, returns the
‘not NULL, not x’ group. Sometimes this may be what we want - but
sometimes we may want the missing values included as well! In that case,
we’d need to change our query to:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> summer_2000</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> sex <span class="op">!=</span> <span class="st">'M'</span> <span class="kw">OR</span> sex <span class="kw">IS</span> <span class="kw">NULL</span>;</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>GROUP BY</code> keyword to aggregate data.</li>
<li>Functions like <code>MIN</code>, <code>MAX</code>, <code>AVG</code>,
<code>SUM</code>, <code>COUNT</code>, etc. operate on aggregated
data.</li>
<li>Aliases can help shorten long queries. To write clear and readable
queries, use the <code>AS</code> keyword when creating aliases.</li>
<li>Use the <code>HAVING</code> keyword to filter on aggregate
properties.</li>
<li>Use a <code>VIEW</code> to access the result of a query as though it
was a new table.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-03-sql-joins"><p>Content from <a href="03-sql-joins.html">Combining Data With Joins</a></p>
<hr>
<p> Last updated on 2023-06-30 | 
        
        <a href="https://github.com/datacarpentry/sql-ecology-lesson/edit/main/episodes/03-sql-joins.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 25 minutes </p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I bring data together from separate tables?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Employ joins to combine data from two tables.</li>
<li>Apply functions to manipulate individual values.</li>
<li>Employ aliases to assign new names to tables and columns in a
query.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="joins"><h2 class="section-heading">Joins<a class="anchor" aria-label="anchor" href="#joins"></a>
</h2>
<hr class="half-width">
<p>To combine data from two tables we use an SQL <code>JOIN</code>
clause, which comes after the <code>FROM</code> clause.</p>
<p>Database tables are used to organize and group data by common
characteristics or principles.<br>
Often, we need to combine elements from separate tables into a single
tables or queries for analysis and visualization. A JOIN is a means for
combining columns from multiple tables by using values common to
each.</p>
<p>The JOIN keyword combined with ON is used to combine fields from
separate tables.</p>
<p>A <code>JOIN</code> clause on its own will result in a cross product,
where each row in the first table is paired with each row in the second
table. Usually this is not what is desired when combining two tables
with data that is related in some way.</p>
<p>For that, we need to tell the computer which columns provide the link
between the two tables using the word <code>ON</code>. What we want is
to join the data with the same species id.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id;</span></code></pre>
</div>
<p><code>ON</code> is like <code>WHERE</code>. It filters things out
according to a test condition. We use the <code>table.colname</code>
format to tell the manager what column in which table we are referring
to.</p>
<p>The output from using the <code>JOIN</code> clause will have columns
from the first table plus the columns from the second table. For the
above statement, the output will be a table that has the following
column names:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="5%">
<col width="45%">
<col width="1%">
<col width="5%">
<col width="4%">
<col width="5%">
<col width="1%">
<col width="8%">
<col width="3%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th>record_id</th>
<th>month</th>
<th>day</th>
<th>year</th>
<th>plot_id</th>
<th>species_id</th>
<th>sex</th>
<th>hindfoot_length</th>
<th>weight</th>
<th>species_id</th>
<th>genus</th>
<th>species</th>
<th>taxa</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>96</td>
<td>8</td>
<td>20</td>
<td>1997</td>
<td>12</td>
<td><strong>DM</strong></td>
<td>M</td>
<td>36</td>
<td>41</td>
<td><strong>DM</strong></td>
<td>Dipodomys</td>
<td>merriami</td>
<td>Rodent</td>
</tr>
<tr class="odd">
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Alternatively, we can use the word <code>USING</code>, as a
short-hand. <code>USING</code> only works on columns which share the
same name. In this case we are telling the manager that we want to
combine <code>surveys</code> with <code>species</code> and that the
common column is <code>species_id</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">USING</span> (species_id);</span></code></pre>
</div>
<p>The output will only have one <strong>species_id</strong> column</p>
<table class="table">
<colgroup>
<col width="5%">
<col width="46%">
<col width="1%">
<col width="5%">
<col width="4%">
<col width="5%">
<col width="1%">
<col width="8%">
<col width="3%">
<col width="5%">
<col width="5%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th>record_id</th>
<th>month</th>
<th>day</th>
<th>year</th>
<th>plot_id</th>
<th>species_id</th>
<th>sex</th>
<th>hindfoot_length</th>
<th>weight</th>
<th>genus</th>
<th>species</th>
<th>taxa</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>96</td>
<td>8</td>
<td>20</td>
<td>1997</td>
<td>12</td>
<td>DM</td>
<td>M</td>
<td>36</td>
<td>41</td>
<td>Dipodomys</td>
<td>merriami</td>
<td>Rodent</td>
</tr>
<tr class="odd">
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>We often won’t want all of the fields from both tables, so anywhere
we would have used a field name in a non-join query, we can use
<code>table.colname</code>.</p>
<p>For example, what if we wanted information on when individuals of
each species were captured, but instead of their species ID we wanted
their actual species names.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.<span class="dt">year</span>, surveys.<span class="dt">month</span>, surveys.<span class="dt">day</span>, species.genus, species.species</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id;</span></code></pre>
</div>
<table class="table">
<colgroup>
<col width="8%">
<col width="73%">
<col width="2%">
<col width="8%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th>year</th>
<th>month</th>
<th>day</th>
<th>genus</th>
<th>species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>1977</td>
<td>7</td>
<td>16</td>
<td>Neotoma</td>
<td>albigula</td>
</tr>
<tr class="odd">
<td>1977</td>
<td>7</td>
<td>16</td>
<td>Dipodomys</td>
<td>merriami</td>
</tr>
<tr class="even">
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Many databases, including SQLite, also support a join through the
<code>WHERE</code> clause of a query.<br>
For example, you may see the query above written without an explicit
JOIN.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.<span class="dt">year</span>, surveys.<span class="dt">month</span>, surveys.<span class="dt">day</span>, species.genus, species.species</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys, species</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> surveys.species_id <span class="op">=</span> species.species_id;</span></code></pre>
</div>
<p>For the remainder of this lesson, we’ll stick with the explicit use
of the <code>JOIN</code> keyword for joining tables in SQL.</p>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that returns the genus, the species name, and the
weight of every individual captured at the site</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species.genus, species.species, surveys.weight</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="different-join-types">Different join types<a class="anchor" aria-label="anchor" href="#different-join-types"></a>
</h3>
<p>We can count the number of records returned by our original join
query.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">USING</span> (species_id);</span></code></pre>
</div>
<p>Notice that this number is smaller than the number of records present
in the survey data.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>This is because, by default, SQL only returns records where the
joining value is present in the joined columns of both tables (i.e. it
takes the <em>intersection</em> of the two join columns). This joining
behaviour is known as an <code>INNER JOIN</code>. In fact the
<code>JOIN</code> keyword is simply shorthand for
<code>INNER JOIN</code> and the two terms can be used interchangeably as
they will produce the same result.</p>
<p>We can also tell the computer that we wish to keep all the records in
the first table by using a <code>LEFT OUTER JOIN</code> clause, or
<code>LEFT JOIN</code> for short. The difference between the two JOINs
can be visualized like so:</p>
<figure><img src="../fig/sql-joins.png" alt="Diagrams representing INNER JOIN and LEFT JOIN each include two overlapping circles labeled A (left) and B (right). For INNER JOIN, the intersection of the two circles is filled in. The associated query is SELECT * FROM A JOIN B ON A.Key = B.Key. For LEFT JOIN, circle A, including its intersection with circle B, is filled in. The associated query is SELECT * FROM A LEFT JOIN B ON A.Key = B.Key." class="figure mx-auto d-block"><figcaption>Diagrams representing INNER JOIN and LEFT JOIN in
SQLite</figcaption></figure><div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Re-write the original query to keep all the entries present in the
<code>surveys</code> table. How many records are returned by this
query?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> surveys</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> species</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">USING</span> (species_id);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<ul>
<li>Count the number of records in the <code>surveys</code> table that
have a <code>NULL</code> value in the <code>species_id</code>
column.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species_id <span class="kw">IS</span> <span class="kw">NULL</span>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Remember: In SQL a <code>NULL</code> value in one table can never be
joined to a <code>NULL</code> value in a second table because
<code>NULL</code> is not equal to anything, not even itself.</p>
</div>
<div class="section level3">
<h3 id="combining-joins-with-sorting-and-aggregation">Combining joins with sorting and aggregation<a class="anchor" aria-label="anchor" href="#combining-joins-with-sorting-and-aggregation"></a>
</h3>
<p>Joins can be combined with sorting, filtering, and aggregation. So,
if we wanted average mass of the individuals on each different type of
treatment, we could do something like</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> plots.plot_type, <span class="fu">AVG</span>(surveys.weight)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> plots</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surveys.plot_id <span class="op">=</span> plots.plot_id</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> plots.plot_type;</span></code></pre>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that returns the number of animals caught of each
genus in each plot. Order the results by plot number (ascending) and by
descending number of individuals in each plot.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.plot_id, species.genus, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> number_indiv</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species.genus, surveys.plot_id</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> surveys.plot_id <span class="kw">ASC</span>, number_indiv <span class="kw">DESC</span>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-4"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that finds the average weight of each rodent species
(i.e., only include species with Rodent in the taxa field).</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.species_id, <span class="fu">AVG</span>(surveys.weight)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species.taxa <span class="op">=</span> <span class="st">'Rodent'</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> surveys.species_id;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="functions-coalesce-and-nullif-and-more"><h2 class="section-heading">Functions <code>COALESCE</code> and <code>NULLIF</code> and
more<a class="anchor" aria-label="anchor" href="#functions-coalesce-and-nullif-and-more"></a>
</h2>
<hr class="half-width">
<p>SQL includes numerous functions for manipulating data. You’ve already
seen some of these being used for aggregation (<code>SUM</code> and
<code>COUNT</code>) but there are functions that operate on individual
values as well. Probably the most important of these are
<code>COALESCE</code> and <code>NULLIF</code>. <code>COALESCE</code>
allows us to specify a value to use in place of <code>NULL</code>.</p>
<p>We can represent unknown sexes with <code>'U'</code> instead of
<code>NULL</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, sex, <span class="fu">COALESCE</span>(sex, <span class="st">'U'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>The lone “sex” column is only included in the query above to
illustrate where <code>COALESCE</code> has changed values; this isn’t a
usage requirement.</p>
<div id="challenge-5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-5"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that returns 30 instead of <code>NULL</code> for
values in the <code>hindfoot_length</code> column.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> hindfoot_length, <span class="fu">COALESCE</span>(hindfoot_length, <span class="dv">30</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-6" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-6"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that calculates the average hind-foot length of each
species, assuming that unknown lengths are 30 (as above).</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, <span class="fu">AVG</span>(<span class="fu">COALESCE</span>(hindfoot_length, <span class="dv">30</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species_id;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p><code>COALESCE</code> can be particularly useful in
<code>JOIN</code>. When joining the <code>species</code> and
<code>surveys</code> tables earlier, some results were excluded because
the <code>species_id</code> was <code>NULL</code> in the surveys table.
We can use <code>COALESCE</code> to include them again, re-writing the
<code>NULL</code> to a valid joining value:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.<span class="dt">year</span>, surveys.<span class="dt">month</span>, surveys.<span class="dt">day</span>, species.genus, species.species</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> <span class="fu">COALESCE</span>(surveys.species_id, <span class="st">'AB'</span>) <span class="op">=</span> species.species_id;</span></code></pre>
</div>
<div id="challenge-7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-7" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-7"></a>
</h3>
<div class="callout-content">
<ul>
<li>Write a query that returns the number of animals caught of each
genus in each plot, assuming that unknown species are all of the genus
“Rodent”.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> plot_id, <span class="fu">COALESCE</span>(genus, <span class="st">'Rodent'</span>) <span class="kw">AS</span> genus2, <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> species</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surveys.species_id<span class="op">=</span>species.species_id</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> plot_id, genus2;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The inverse of <code>COALESCE</code> is <code>NULLIF</code>. This
returns <code>NULL</code> if the first argument is equal to the second
argument. If the two are not equal, the first argument is returned. This
is useful for “nulling out” specific values.</p>
<p>We can “null out” plot 7:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, plot_id, <span class="fu">NULLIF</span>(plot_id, <span class="dv">7</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys;</span></code></pre>
</div>
<p>Some more functions which are common to SQL databases are listed in
the table below:</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="89%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>ABS(n)</code></td>
<td>Returns the absolute (positive) value of the numeric expression
<em>n</em>
</td>
</tr>
<tr class="even">
<td><code>COALESCE(x1, ..., xN)</code></td>
<td>Returns the first of its parameters that is not NULL</td>
</tr>
<tr class="odd">
<td><code>LENGTH(s)</code></td>
<td>Returns the length of the string expression <em>s</em>
</td>
</tr>
<tr class="even">
<td><code>LOWER(s)</code></td>
<td>Returns the string expression <em>s</em> converted to lowercase</td>
</tr>
<tr class="odd">
<td><code>NULLIF(x, y)</code></td>
<td>Returns NULL if <em>x</em> is equal to <em>y</em>, otherwise returns
<em>x</em>
</td>
</tr>
<tr class="even">
<td>
<code>ROUND(n)</code> or <code>ROUND(n, x)</code>
</td>
<td>Returns the numeric expression <em>n</em> rounded to <em>x</em>
digits after the decimal point (0 by default)</td>
</tr>
<tr class="odd">
<td><code>TRIM(s)</code></td>
<td>Returns the string expression <em>s</em> without leading and
trailing whitespace characters</td>
</tr>
<tr class="even">
<td><code>UPPER(s)</code></td>
<td>Returns the string expression <em>s</em> converted to uppercase</td>
</tr>
</tbody>
</table>
<p>Finally, some useful functions which are particular to SQLite are
listed in the table below:</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="89%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>RANDOM()</code></td>
<td>Returns a random integer between -9223372036854775808 and
+9223372036854775807.</td>
</tr>
<tr class="even">
<td><code>REPLACE(s, f, r)</code></td>
<td>Returns the string expression <em>s</em> in which every occurrence
of <em>f</em> has been replaced with <em>r</em>
</td>
</tr>
<tr class="odd">
<td>
<code>SUBSTR(s, x, y)</code> or <code>SUBSTR(s, x)</code>
</td>
<td>Returns the portion of the string expression <em>s</em> starting at
the character position <em>x</em> (leftmost position is 1), <em>y</em>
characters long (or to the end of <em>s</em> if <em>y</em> is
omitted)</td>
</tr>
</tbody>
</table>
<div id="challenge-8" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-8" class="callout-inner">
<h3 class="callout-title">Challenge:<a class="anchor" aria-label="anchor" href="#challenge-8"></a>
</h3>
<div class="callout-content">
<p>Write a query that returns genus names (no repeats), sorted from
longest genus name down to shortest.</p>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" aria-labelledby="headingSolution9" data-bs-parent="#accordionSolution9">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> genus</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">LENGTH</span>(genus) <span class="kw">DESC</span>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>As we saw before, aliases make things clearer, and are especially
useful when joining tables.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surv.<span class="dt">year</span> <span class="kw">AS</span> yr, surv.<span class="dt">month</span> <span class="kw">AS</span> mo, surv.<span class="dt">day</span> <span class="kw">AS</span> <span class="dt">day</span>, sp.genus <span class="kw">AS</span> gen, sp.species <span class="kw">AS</span> sp</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">AS</span> surv</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species <span class="kw">AS</span> sp</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> surv.species_id <span class="op">=</span> sp.species_id;</span></code></pre>
</div>
<p>To practice we have some optional challenges for you.</p>
<div id="challenge-optional" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-optional" class="callout-inner">
<h3 class="callout-title">Challenge (optional):<a class="anchor" aria-label="anchor" href="#challenge-optional"></a>
</h3>
<div class="callout-content">
<p>SQL queries help us <em>ask</em> specific <em>questions</em> which we
want to answer about our data. The real skill with SQL is to know how to
translate our scientific questions into a sensible SQL query (and
subsequently visualize and interpret our results).</p>
<p>Have a look at the following questions; these questions are written
in plain English. Can you translate them to <em>SQL queries</em> and
give a suitable answer?</p>
<ol style="list-style-type: decimal">
<li><p>How many plots from each type are there?</p></li>
<li><p>How many specimens are of each sex are there for each year,
including those whose sex is unknown?</p></li>
<li><p>How many specimens of each species were captured in each type of
plot, excluding specimens of unknown species?</p></li>
<li><p>What is the average weight of each taxa?</p></li>
<li><p>What are the minimum, maximum and average weight for each species
of Rodent?</p></li>
<li><p>What is the average hindfoot length for male and female rodent of
each species? Is there a Male / Female difference?</p></li>
<li><p>What is the average weight of each rodent species over the course
of the years? Is there any noticeable trend for any of the
species?</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10">
  Proposed solutions:
  </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" aria-labelledby="headingSolution10" data-bs-parent="#accordionSolution10">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>Solution:</li>
</ol>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> plot_type, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> num_plots</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> plots</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> plot_type;</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Solution:</li>
</ol>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="dt">year</span>, sex, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> num_animal</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> sex, <span class="dt">year</span>;</span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Solution:</li>
</ol>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> species_id, plot_type, <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> plots <span class="kw">USING</span>(plot_id) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> species_id <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species_id, plot_type;</span></code></pre>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Solution:</li>
</ol>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> taxa, <span class="fu">AVG</span>(weight) </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species <span class="kw">ON</span> species.species_id <span class="op">=</span> surveys.species_id</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> taxa;</span></code></pre>
</div>
<ol start="5" style="list-style-type: decimal">
<li>Solution:</li>
</ol>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.species_id, <span class="fu">MIN</span>(weight), <span class="fu">MAX</span>(weight), <span class="fu">AVG</span>(weight) <span class="kw">FROM</span> surveys </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species <span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> taxa <span class="op">=</span> <span class="st">'Rodent'</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> surveys.species_id;</span></code></pre>
</div>
<ol start="6" style="list-style-type: decimal">
<li>Solution:</li>
</ol>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.species_id, sex, <span class="fu">AVG</span>(hindfoot_length)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys <span class="kw">JOIN</span> species <span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> (taxa <span class="op">=</span> <span class="st">'Rodent'</span>) <span class="kw">AND</span> (sex <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>) </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> surveys.species_id, sex;</span></code></pre>
</div>
<ol start="7" style="list-style-type: decimal">
<li>Solution:</li>
</ol>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> surveys.species_id, <span class="dt">year</span>, <span class="fu">AVG</span>(weight) <span class="kw">as</span> mean_weight</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> surveys </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> species <span class="kw">ON</span> surveys.species_id <span class="op">=</span> species.species_id </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> taxa <span class="op">=</span> <span class="st">'Rodent'</span> <span class="kw">GROUP</span> <span class="kw">BY</span> surveys.species_id, <span class="dt">year</span>;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use a <code>JOIN</code> clause to combine data from two tables—the
<code>ON</code> or <code>USING</code> keywords specify which columns
link the tables.</li>
<li>Regular <code>JOIN</code> returns only matching rows. Other join
clauses provide different behavior, e.g., <code>LEFT JOIN</code> retains
all rows of the table on the left side of the clause.</li>
<li>
<code>COALESCE</code> allows you to specify a value to use in place
of <code>NULL</code>, which can help in joins</li>
<li>
<code>NULLIF</code> can be used to replace certain values with
<code>NULL</code> in results</li>
<li>Many other functions like <code>COALESCE</code> and
<code>NULLIF</code> can operate on individual values.</li>
</ul>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/datacarpentry/sql-ecology-lesson/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/datacarpentry/sql-ecology-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/datacarpentry/sql-ecology-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/sql-ecology-lesson/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.12.5)</a>,
        <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.5.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.17" class="external-link">varnish (0.2.17)</a>.</p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.github.io/sql-ecology-lesson/instructor/aio.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/sql-ecology-lesson/instructor/aio.html",
  "identifier": "https://datacarpentry.github.io/sql-ecology-lesson/instructor/aio.html",
  "dateCreated": "2015-02-10",
  "dateModified": "2023-08-01",
  "datePublished": "2023-08-01"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

